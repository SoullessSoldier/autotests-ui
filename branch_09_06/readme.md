# 9.6 Добавляем информацию о переменных окружения в Allure отчет
[назад](../readme.md)


Содержание:
- [Добавление переменных окружения в Allure отчет](#добавление-переменных-окружения-в-allure-отчет)
- [Практика работы с переменными окружения в Allure](#практика-работы-с-переменными-окружения-в-allure)


## Добавление переменных окружения в Allure отчет
Ссылки:
- [Официальная документация Allure](https://allurereport.org/docs/how-it-works-environment-file/)
- [Пример Allure отчета с переменными окружения](https://nikita-filonov.github.io/playwright_typescript_api/)

В Allure отчет можно добавлять переменные окружения или любые другие настройки, которые будут отображаться в отчете. Это очень полезно, чтобы видеть общую информацию о том, на каком окружении выполнялись автотесты, какие тестовые данные использовались и т.д. Например, в Allure отчете можно увидеть добавленную информацию об окружении на примере по следующей ссылке: https://nikita-filonov.github.io/playwright_typescript_api/

Теперь давайте настроим автоматическое добавление информации о переменных окружения в нашем проекте.

### 1. Работа с environment.properties
В Allure для отображения информации об окружении требуется файл environment.properties, который следует поместить в директорию allure-results. Пример содержимого environment.properties:
```ini
os_platform = linux
os_release = 5.15.0-60-generic
os_version = #66-Ubuntu SMP Fri Jan 20 14:29:49 UTC 2023
python_version = Python 3.10.9
```

Давайте добавим в нашу текущую папку *allure-results* файл *environment.properties* и поместим в него содержимое из примера выше:
```
.
└── allure-results/
    └── environment.properties
```

### 2. Создаем функцию для генерации файла environment.properties
Теперь давайте создадим функцию, которая будет автоматически создавать файл *environment.properties*. Для этого мы будем использовать настройки из файла *config.py*, добавив новый параметр *allure_results_dir*, чтобы хранить путь к папке *allure-results* в одном месте, как мы делаем с *videos_dir* и *tracing_dir*.  
Добавили новое поле *allure_results_dir* по аналогии с *videos_dir* и *tracing_dir*.

Теперь создадим функцию *create_allure_environment_file*, которая будет автоматически создавать файл *environment.properties*. Для этого создадим файл *environment.py* в папке *tools/allure*:
```
.
└── tools/
    └── allure/
        └── environment.py
```
В файле *environment.py* создадим функцию *create_allure_environment_file*.

### 3. Автоматически создаем файл environment.properties
Чтобы автоматически сохранять файл *environment.properties* после завершения всех автотестов, можно использовать фикстуру со скоупом *session* и параметром *autouse=True*. Создадим такую фикстуру в файле *./fixtures/allure.py*, добавив в него фикстуру *save_allure_environment_file*, которая будет запускать функцию *create_allure_environment_file* по завершении автотестов.  
Добавим эту фикстуру в файл *conftest.py*  
Теперь фикстура *save_allure_environment_file* будет автоматически запускаться на каждую тестовую сессию и по окончании тестов создавать файл *environment.properties*

### 4. Тестирование

Теперь давайте запустим все наши автотесты и посмотрим на Allure отчет.  
Теперь в отчете на виджете Environment мы можем видеть информацию об окружении.

### Заключение
В данном уроке мы рассмотрели, как можно добавить информацию об окружении в Allure отчет. Также стоит отметить, что в отчет можно добавлять любые переменные и информацию, не обязательно ограничиваясь данными из настроек. Например, можно включить версию операционной системы, версии браузеров.

[вверх](#96-добавляем-информацию-о-переменных-окружения-в-allure-отчет)


## Практика работы с переменными окружения в Allure

[ссылка на описание домашней работы](./homework.md)

[вверх](#96-добавляем-информацию-о-переменных-окружения-в-allure-отчет)