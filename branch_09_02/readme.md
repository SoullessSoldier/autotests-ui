# 9.2 Запуск автотестов на разных браузерах
[назад](../readme.md)


Содержание:
- [Запускаем автотесты на разных браузерах](#запускаем-автотесты-на-разных-браузерах)
- [Практическое задание: запуск автотестов на нескольких браузерах](#практическое-задание-запуск-автотестов-на-нескольких-браузерах)


## Запускаем автотесты на разных браузерах

До этого мы запускали автотесты на одном браузере — **chromium**. Теперь разберемся, как, используя настройки из предыдущего урока, запускать их на нескольких браузерах.

### 1. Параметризация фикстур chromium_page и chromium_page_with_state

Первое, что необходимо сделать, — добавить параметризацию к фикстурам *chromium_page* и *chromium_page_with_state*

### 2. Почему тесты продолжают запускаться на chromium?

Несмотря на добавленную параметризацию, если мы сейчас запустим автотесты, они по-прежнему будут запускаться на **chromium**. Это происходит потому, что функция *initialize_playwright_page*, отвечающая за инициализацию страницы, использует браузер **chromium** по умолчанию.

### 3. Динамическая передача браузера
Чтобы исправить это, нужно сделать так, чтобы браузер передавался в функцию динамически. Для этого добавим в ффункцию *initialize_playwright_page* аргумент *browser_type*, который будет содержать тип браузера.

Теперь браузер передается как аргумент browser_type, и это позволяет динамически инициализировать нужный браузер в зависимости от параметров.

### 4. Обновление фикстур
Теперь нужно передать аргумент *browser_type* в функцию *initialize_playwright_page* внутри фикстур *chromium_page* и *chromium_page_with_state*

### 5. Управление браузерами через переменные окружения
В файле .env сейчас содержится переменная:
```env
BROWSERS=["chromium", "webkit"]
```
                  
Соответственно, все автотесты будут запускаться сначала на **chromium**, а затем на **webkit**. Если вы хотите добавить, например, **firefox**, достаточно добавить его в список в переменной *BROWSERS*.

### 6. Тестирование
Теперь проверим, как это работает. Запустим автотесты командой:
```sh
python -m pytest -m "regression" --alluredir=./allure-results
```
                  
После запуска вы увидите, что автотесты сначала будут выполнены на **chromium**, затем на **webkit**. В Allure отчете будет видно, на каком браузере запускался каждый тест.

### 7. Отображение браузеров в Allure
В Allure вы сможете увидеть, рядом с каждым тестом будет указано название браузера, на котором он выполнялся. Это очень удобно при анализе, поскольку позволяет сразу понимать, на каком браузере произошла ошибка.


[вверх](#92-запуск-автотестов-на-разных-браузерах)


## Практическое задание: запуск автотестов на нескольких браузерах

Вам предстоит запустить автотесты на следующих комбинациях браузеров:
- Chromium, WebKit
- WebKit, Firefox
- Chromium, WebKit, Firefox

Для запуска автотестов используйте команду:
```sh
python -m pytest -m "regression" --alluredir=./allure-results
```

**Задача**: в качестве результата задания вам нужно отправить три HTML файла с Allure отчетами в ваш GitHub репозиторий:
```text
.
├── chromium-webkit/
│   └── index.html
├── webkit-firefox/
│   └── index.html
└── chromium-webkit-firefox/
    └── index.html
```

### Критерии успешного выполнения
1. Подготовка и запуск
    - Запуск выполнен маркером: *python -m pytest -m "regression" --alluredir=./allure-results*.
    - Тесты проходят без падений (статус PASSED либо SKIPPED/DESELECTED допустим, FAIL — нет)
2. Матрица браузеров (3 прогона)
    - Выполнен прогон **Chromium** + **WebKit**.
    - Выполнен прогон **WebKit** + **Firefox**.
    - Выполнен прогон **Chromium** + **WebKit** + **Firefox**.
3. Генерация Allure-отчётов
    - Для каждого прогона отчёт сгенерирован командой вида: *allure generate ./allure-results --clean -o <папка_отчёта> --single-file*.
    - В репозитории присутствуют три каталога верхнего уровня строго с такими именами и содержимым (один из вариантов на каталог):
        - *chromium-webkit/* — *index.html* **или** *index.zip* **или** набор скриншотов (*overview.png*, *suites.png*, *categories.png*).
        - *webkit-firefox/* — *index.html* **или** *index.zip* или набор скриншотов.
        - *chromium-webkit-firefox/* — *index.html* **или** *index.zip* или набор скриншотов.
    - Если размер *index.html* > 100 MB — загружен *index.zip*.
        - Если и он велик — загружены **скриншоты** ключевых разделов (минимум: *overview.png*, *suites.png*, *categories.png*).
4. Структура репозитория
```text
.
├── chromium-webkit/
│   └── index.html | index.zip | (overview.png, suites.png, categories.png)
├── webkit-firefox/
│   └── index.html | index.zip | (overview.png, suites.png, categories.png)
└── chromium-webkit-firefox/
    └── index.html | index.zip | (overview.png, suites.png, categories.png)

```
5. Качество и оформленность
- Папки названы **точно**: *chromium-webkit*, *webkit-firefox*, *chromium-webkit-firefox*.
- Отчёты открываются локально (HTML/ZIP) или скриншоты читаемы.
- Нет лишних больших бинарников/мусора в корне репозитория.

[вверх](#92-запуск-автотестов-на-разных-браузерах)
