# 10.3 Подготовка проекта к запуску на CI
[назад](../readme.md)


Содержание:
- [Фиксируем зависимости Python проекта](#фиксируем-зависимости-python-проекта)
- [Добавляем файл .gitignore](#добавляем-файл-gitignore)
- [Проверка подготовки проекта к запуску на CI](#проверка-подготовки-проекта-к-запуску-на-ci)

## Фиксируем зависимости Python проекта

В данном уроке мы подготовим проект *autotests-ui* для запуска на CI. В этом шаге зафиксируем все Python-зависимости проекта в файл *requirements.txt*.

### Зачем фиксировать зависимости Python?

Фиксация зависимостей Python необходима по нескольким причинам:
- Это **хорошая практика**, которая позволяет любому разработчику быстро установить и запустить ваш проект, обеспечивая идентичную версию зависимостей.
- Это необходимо при **командной работе**, чтобы ваши коллеги могли запускать проект локально и легко устанавливать те же зависимости.
- Для **CI/CD**: фиксированные зависимости позволяют сократить команды установки. Вместо того чтобы писать каждую команду для установки (например, **pip install pytest**, **pip install playwright** и т.д.), вы можете использовать одну команду, чтобы установить все зависимости разом.

### Где фиксируются зависимости Python?
Зависимости Python, как правило, фиксируются в текстовом файле под названием requirements.txt. Хотя название файла может быть произвольным, стандартное имя **requirements.txt** позволяет разработчикам сразу понять, что именно в этом файле указаны зависимости проекта.

### Как фиксировать зависимости проекта?
Существует несколько способов фиксации зависимостей в Python:
1. **Ручное добавление в *requirements.txt***: После установки новой библиотеки командой pip install some-library добавьте строку some-library=={version} в requirements.txt. Это наиболее надежный способ, поскольку он позволяет поддерживать файл актуальным и избегать избыточных зависимостей.
2. **Автоматическая генерация *requirements.txt* с помощью *pip freeze***: Команда *pip freeze > requirements.txt* создает файл *requirements.txt* и записывает в него все библиотеки, установленные в текущем виртуальном окружении. Однако такой подход может добавить вложенные зависимости (то есть библиотеки, требуемые установленными пакетами), что увеличивает файл и приводит к возможным конфликтам.
3. **Добавление библиотек из вывода команды *pip list***: Вы можете использовать команду *pip list* для просмотра установленных библиотек и вручную добавлять нужные зависимости в *requirements.txt*. Это рабочий способ, но требует внимательности, чтобы избежать включения ненужных библиотек.

### Как установить Python-зависимости?

Чтобы установить зависимости из файла *requirements.txt*, выполните команду:
```sh
pip install -r requirements.txt
```
Эта команда указывает пакетному менеджеру *pip* установить все зависимости, указанные в *requirements.txt*.

### Работа с версиями зависимостей в requirements.txt
При фиксации версий в requirements.txt можно использовать различные операторы для управления диапазонами версий:
- *==*: зафиксировать точную версию. Например, *pytest==8.3.3* гарантирует использование версии 8.3.3.
- *>=*: минимальная версия, например, *pytest>=8.0.0*, устанавливает минимально допустимую версию 8.0.0, но допускает обновления.
- *<=*: максимальная версия, например, *pytest<=8.3.3*.
- *~=* (тильда): фиксирует совместимые версии. Например, *pytest~=8.3* означает, что могут быть установлены версии от 8.3.0 до 8.4 (не включая 8.4), что полезно для предотвращения крупных изменений.

Такой подход помогает избежать потенциальных проблем при установке зависимостей и их обновлении.
           

[вверх](#103-подготовка-проекта-к-запуску-на-ci)


## Добавляем файл .gitignore

### Для чего нужен файл .gitignore?
Файл *.gitignore* сообщает Git, какие файлы и папки необходимо исключить из репозитория. Например, если у вас локально создана папка .venv для виртуального окружения Python, она специфична только для вашего локального окружения и не нужна в репозитории, так как у других разработчиков/автоматизаторов будет своя .venv для их окружений.

Ещё один пример — это папки *videos* и *tracing*, в которых хранятся видео и Playwright-трейсинг каждого запуска теста. Эти файлы генерируются заново для каждого автотеста и не имеют смысла в репозитории.

### Создаем файл .gitignore

В корне проекта autotests-ui создадим файл .gitignore:
```
.
└── .gitignore
```

### Публикация изменений на GitHub

После публикации, открыв репозиторий на GitHub, вы увидите, что в нем отсутствуют файлы и папки, перечисленные в .gitignore, что является хорошей практикой.

### Рекомендация: Добавление .env в .gitignore

Обычно в *.gitignore* добавляют также файл *.env*, так как он может содержать конфиденциальные данные, такие как токены, пароли и другие пользовательские данные. В нашем случае таких данных пока нет, но в будущем это может пригодиться.

Важно! Иногда Git может закешировать файлы, которые должны быть исключены. Если после создания *.gitignore* он не видит файлы/папки, добавленные в него, выполните команду:
```sh
git rm -r --cached .
```
                  
Эта команда удаляет кешированные файлы, и при следующем *git add .* только нужные файлы будут добавлены, и *.gitignore* будет работать корректно.

[вверх](#103-подготовка-проекта-к-запуску-на-ci)


## Проверка подготовки проекта к запуску на CI

После выполнения всех шагов данного урока, ваш проект должен соответствовать следующим условиям:
1. **Добавлен файл *requirements.txt*** с зафиксированными зависимостями.
2. **Добавлен файл *.gitignore*** с перечнем файлов и папок, исключаемых из репозитория.

**Решением данного задания** является выполнение всех перечисленных пунктов. Дополнительные действия не требуются.

[вверх](#103-подготовка-проекта-к-запуску-на-ci)
