# 6.6 Знакомство с pytest плагинами
[назад](../readme.md)

Есть одна проблема: фикстуры из одного файла *conftest.py* недоступны в других директориях. Например, фикстуры из *users/conftest.py* не будут видны в тестах, расположенных в *accounts/*.

## Как решить проблему с помощью *pytest_plugins*
Чтобы избежать проблемы видимости и дублирования, можно использовать плагины, которые делают фикстуры доступными глобально по всему проекту. Это достигается с помощью переменной *pytest_plugins*, которая позволяет подключать отдельные модули с фикстурами.

Что это дает?
- **Глобальная доступность фикстур**: фикстуры, объявленные в плагинах, становятся видны во всех тестах без необходимости заботиться о том, в какой директории они находятся.
- **Гибкость**: фикстуры можно разделить по смысловым группам, и каждая группа будет доступна во всем проекте.
Модульность: каждый плагин можно организовать как отдельный файл или набор файлов, что делает проект более структурированным.
Пример:
```python
# conftest.py
pytest_plugins = (
    "tests.fixtures.browsers",
    "tests.fixtures.api",
)
```
                  
В этом примере мы подключаем модули с фикстурами browsers и pages, и теперь фикстуры из этих модулей доступны глобально для всех тестов проекта, вне зависимости от их директории.

Пример использования pytest_plugins на практике
Предположим, у вас есть проект с разными группами тестов, например, тесты для пользователей и аккаунтов, и в каждой группе нужны свои фикстуры. Вместо того чтобы дублировать фикстуры в каждом conftest.py, мы можем сделать их глобальными через плагины.

Создадим отдельные модули с фикстурами. Например, *browsers.py* для работы с браузерами:
```python
# tests/fixtures/browsers.py
import pytest

@pytest.fixture
def browser():
    # Логика для инициализации браузера
    pass
```
                  
И другой модуль, например, для работы с API:
```python
# tests/fixtures/api.py
import pytest

@pytest.fixture
def api_client():
    # Возвращаем клиент для работы с API
    pass
```
                  
В файле conftest.py мы подключаем эти модули через переменную *pytest_plugins*:
```python
# conftest.py
pytest_plugins = (
    "tests.fixtures.browsers",
    "tests.fixtures.api",
)
```


Теперь все тесты в проекте могут использовать фикстуры из этих модулей, не дублируя их в каждом *conftest.py*.


## Когда стоит оставлять фикстуры в conftest.py?
Хотя использование плагинов — это мощное решение, в некоторых случаях имеет смысл оставлять фикстуры в conftest.py. Это особенно актуально для тех фикстур, которые нужны только в одной конкретной группе тестов и не используются глобально. Таким образом, можно локализовать специфические фикстуры для конкретных тестов и избежать их распространения на весь проект.

## Преимущества использования плагинов для фикстур
- **Глобальная доступность фикстур**: Вам не нужно беспокоиться о том, где лежат файлы *conftest.py*. Все необходимые фикстуры доступны везде, где нужно.
- **Модульность и гибкость**: Фикстуры можно организовать в виде отдельных модулей, что облегчает их поддержку и развитие.
- **Упрощение структуры проекта**: Вы можете легко управлять фикстурами, избегая чрезмерной сложности в *conftest.py* файлах. Они больше не становятся огромными файлами с сотнями строк кода.