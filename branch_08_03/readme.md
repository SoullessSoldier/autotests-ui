# 8.3 Добавление Allure шагов в автотесты
[назад](../readme.md)

Содержание:
- [Знакомство с allure.step](#знакомство-с-allurestep)

## Знакомство с allure.step

### Способы добавления шагов:
1. Использование контекстного менеджера with allure.step(...)
2. Использование декоратора @allure.step

У метода с контекстным менеджером нет ограничений по количеству шагов внутри одной функции. С декоратором @allure.step, один шаг = одна функция, что ограничивает его гибкость. Однако это не делает декоратор бесполезным. Он очень полезен для создания агрегированных или вложенных шагов.

### Использование шаблонов в шагах
В @allure.step можно использовать шаблоны для передачи параметров, которые будут видны в отчете:
```python
@allure.step("Creating course with title '{title}'")
def create_course(title: str):
    pass
```

[вверх](#83-добавление-allure-шагов-в-автотесты)


## Расстановка allure.step для BasePage
Начнем с добавления шагов Allure для класса *BasePage*. Все наши автотесты используют методы этого класса, и каждый автотест вызывает метод *visit*.

### Правильное использование allure.step
Важно помнить, что шаги Allure нужно добавлять на уровне методов, таких как BasePage.visit, а не непосредственно в тестах.

### Рекомендации:
- **Используйте шаги на уровне методов.** Это позволяет сократить дублирование кода и обеспечит, что каждый шаг будет правильно отражен в отчете.
- **Не злоупотребляйте явным добавлением шагов в тестах.** Добавление шагов непосредственно в тестах может усложнить их логику и привести к хаосу в отчетах.
- **Поддерживайте структуру отчета.** Благодаря правильному добавлению шагов, отчет становится более наглядным и позволяет быстрее находить возможные проблемы.

[вверх](#83-добавление-allure-шагов-в-автотесты)


## Расстановка allure.step для Page Factory
Пришло время применить паттерн Page Factory, за один шаг мы сможем расставить все *allure.step* во всех автотестах. Позже, конечно, нам потребуется добавить шаги в Page Component-ы и Page Object-ы, но базовое покрытие шагами уже будет готово.

### Переопределение свойства *type_of*
Мы добавили свойство *type_of*, которое используется в allure шагах для указания типа элемента, с которым взаимодействуем: например, "button", "input", "textarea", "text". Эта концепция особенно важна, когда мы работаем с различными элементами интерфейса, которые имеют общие методы, такие как клик или проверка видимости. Например:
- Кнопка входа — *Clicking button "Login"*
- Поле ввода — *Checking that input "Username" is visible*

### Динамическая генерация локаторов

Локаторы для элементов формируются динамически, что еще больше повышает гибкость и универсальность нашего подхода. Например, метод get_locator() может принимать разные параметры и возвращать уникальный локатор для каждого элемента на странице. Это означает, что вам не нужно вручную добавлять уникальные шаги для каждого взаимодействия с локатором — всё делается автоматически.

Сильные стороны этого подхода:
- **Экономия времени**: Вам не нужно каждый раз прописывать шаги, связанные с локаторами, они будут динамически генерироваться и добавляться в отчеты.
- **Поддерживаемость**: Если вам понадобится изменить какой-либо шаг или формат локатора, это можно сделать в одном месте (например, в BaseElement), и все изменения мгновенно отразятся на всех автотестах.

### Динамическая генерация локаторов
Локаторы для элементов формируются динамически, что еще больше повышает гибкость и универсальность нашего подхода. Например, метод get_locator() может принимать разные параметры и возвращать уникальный локатор для каждого элемента на странице.

### Автоматическая генерация шагов

Мы добавили allure.step во все ключевые методы: get_locator(), click(), check_visible(), check_have_text(). Благодаря этому, шаги добавляются автоматически при вызове этих методов. Это позволяет вам избавиться от необходимости каждый раз вручную прописывать шаги в тестах.

Главная ценность:
- **Унификация:** Все шаги будут иметь единый стиль и формат, что делает отчеты предсказуемыми и легко читаемыми.
- **Масштабируемость:** Если количество тестов растет, этот подход позволяет поддерживать их без значительных затрат на ручное написание шагов для каждого теста.

### Использование атрибута name
Атрибут *name* заранее был добавлен при знакомстве с паттерном Page Factory и реализован в BaseElement. Это позволяет нам эффективно описывать элементы в отчетах, например:
- *Clicking button "Submit"*
- *Checking that input "Username" has value "TestUser"*

[вверх](#83-добавление-allure-шагов-в-автотесты)


## Добавляем allure.step в компоненты Page Component
В этом шаге мы потренируемся добавлять allure.step в компоненты, которые были написаны при изучении паттерна Page Component. Это позволит автоматически добавлять шаги в Allure-отчеты и собирать параметры, которые передаются в методы. Ниже рассмотрим, как можно улучшить отчетность с помощью нескольких примеров компонентов

Рассмотрим следующие компоненты:
- *LoginFormComponent*
- *RegistrationFormComponent*
- *CourseViewComponent*
- *CourseViewMenuComponent*
- *SidebarComponent*
- *SidebarListItemComponent*
- *CreateCourseExerciseFormComponent*

[вверх](#83-добавление-allure-шагов-в-автотесты)


## Добавляем allure.step в страницы Page Object
Теперь давайте потренируемся расставлять allure.step для нескольких страниц:
- LoginPage
- CoursesListPage

[вверх](#83-добавление-allure-шагов-в-автотесты)


## Практика работы с allure.step (домашняя работа)
[ссылка на описание домашней работы](./homework.md)

[вверх](#83-добавление-allure-шагов-в-автотесты)