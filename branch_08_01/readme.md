# 8.1 Знакомство с Allure
[назад](../readme.md)

Содержание:
- [Знакомство с Allure](#знакомство-с-allure)
- [Знакомство с Allure отчетом](#знакомство-с-allure-отчетом)
- [Установка и настройка Allure для использования с Pytest](#установка-и-настройка-allure-для-использования-с-pytest)
- [Запуск автотестов и генерация Allure отчета](#запуск-автотестов-и-генерация-allure-отчета)
- [Полезное](#полезное)

## Знакомство с Allure

Ссылки:
- [Официальный сайт Allure](https://allurereport.org/)
- [Официальная документация Allure report](https://allurereport.org/docs/)
- [Интеграция Allure с Pytest](https://allurereport.org/docs/pytest/)
- [Пример Allure отчета для UI автотестов](https://nikita-filonov.github.io/playwright_python/)
- [Allure Pytest configuration](https://allurereport.org/docs/pytest-configuration/)


Allure — это популярная система для генерации и отображения отчетов по автоматическим тестам. Она помогает структурировать, визуализировать и анализировать результаты тестирования, что делает процесс анализа ошибок и прогресса тестов проще и нагляднее.

### Зачем нужен Allure?
1. **Визуализация результатов тестов**: Allure превращает сухие логи и выводы в удобный HTML-отчет с красивым оформлением и наглядной структурой.
Структурирование данных: В Allure можно группировать тесты по различным параметрам: типу тестов (например, Smoke, Regression), функциональным областям, тегам и т.д.
2. **Легкая интеграция с различными инструментами**: Allure поддерживает интеграцию с различными фреймворками для тестирования, такими как Pytest, JUnit, TestNG и другими, а также с системами CI/CD, например, Jenkins или TeamCity.
3. **Поддержка вложений**: Allure позволяет добавлять к отчетам файлы (скриншоты, логи, данные о выполнении), что упрощает анализ ошибок.
4. **История запусков тестов**: Он сохраняет историю предыдущих запусков тестов, что помогает отслеживать прогресс, выявлять паттерны проблем и анализировать стабильность тестов.

### Основные возможности Allure:
- **Генерация детализированных отчетов**: Отображение результата тестов (успех, неудача, пропуск) с указанием причин и контекста.
- **Группировка и фильтрация**: Разделение отчетов на группы по тегам, категориям или шагам.
- **Шаги тестов**: В отчете можно увидеть пошаговое выполнение каждого теста.
- **Вложенные шаги и результаты**: Можно подробно описывать шаги тестов и их результаты, что помогает при дебаге.
- **Анализ дефектов**: Allure может показывать информацию о дефектах и причины падения тестов.

[вверх](#81-знакомство-с-allure)

## Знакомство с Allure отчетом

Теперь давайте детально рассмотрим, какую информацию отображает Allure отчет.  
- **Overview** — общая информация  
На странице Overview отображается сводка по запуску автотестов: количество выполненных тестов, сколько из них прошло успешно, сколько завершилось с ошибками, и сколько было пропущено. Здесь же указаны дата и время начала тестирования, общее время выполнения тестов и другие базовые показатели, позволяющие быстро оценить состояние тестирования.  
Например, вы можете увидеть такие ключевые метрики как:
  - Количество пройденных, проваленных и сломанных тестов.
  - Процент успешности тестирования.
  - Общая продолжительность прогона тестов.

  Это основной экран, который позволяет поверхностно оценить общие результаты.

- **Suites** — информация о тест кейсах  
На странице Suites предоставляется детальная информация по каждому автотесту. Все тесты группируются по "сьютам" (suites) — наборам тестов, которые обычно отражают иерархию файлов и классов тестов в вашем проекте.  
На странице справа можно увидеть подробную информацию о каждом тесте:
  - Название теста.
  - Параметры, с которыми тест был запущен.
  - Шаги выполнения теста (steps).
  - Уровень важности (severity).
  - ремя выполнения.
  - Скриншоты, если они были сделаны.  

  Таким образом, страница Suites является главным разделом для глубокого анализа конкретных тестов.

- **Graphs** — статистика и аналитика
На странице Graphs представлены различные графики с аналитикой. Здесь можно увидеть визуальные данные, такие как:
  - Время выполнения тестов.
  - Распределение статусов тестов (успешные, проваленные, сломанные).
  - Анализ критичности тестов (severity).

  Эта страница полезна для того, чтобы быстро оценить общие тренды и понять, где возникают проблемы.

- **Timeline** — время выполнения
Страница Timeline отображает временные диаграммы, показывающие выполнение тестов в реальном времени. Это особенно полезно для анализа, если тесты запускались параллельно, и вы хотите понять, сколько времени занимают отдельные тесты или целые группы тестов.

- **Другие разделы (Categories, Behaviors, Packages)**
Кроме перечисленных разделов, в Allure также есть:
  - **Categories** — здесь отображается информация по категориям, например, можно разбить тесты по типам ошибок.
  - **Behaviors** — группировка тестов по поведению или функциональности.
  - **Packages** — группировка тестов по пакетам и модулям.

  Хотя эти разделы дают дополнительные способы представления данных, они по сути повторяют информацию, которую можно найти на странице Suites, но с другой группировкой

[вверх](#81-знакомство-с-allure)

## Установка и настройка Allure для использования с Pytest

Ссылки:
- [Установка Allure для Windows](https://allurereport.org/docs/install-for-windows/)
- [Установка Allure для MacOS](https://allurereport.org/docs/install-for-macos/)
- [Установка Allure для Linux](https://allurereport.org/docs/install-for-linux/)

[вверх](#81-знакомство-с-allure)


## Запуск автотестов и генерация Allure отчета

### Запуск автотестов
Для генерации базового отчета достаточно добавить флаг *--alluredir=./allure-results*, где *./allure-results* — это папка, в которой будут сохраняться результаты выполнения автотестов. Пример команды для запуска всех UI автотестов:
```sh
python -m pytest -m "regression" --alluredir=./allure-results
```

### Генерация отчета
Allure поддерживает два способа генерации отчетов:
- **Генерация статического отчета** — создает файлы, которые можно открыть в браузере локально или передать кому-то в виде архива. Такой отчет можно разместить в файловом хранилище, и для его просмотра не требуется установка Allure.
- **Генерация динамического отчета** — Allure локально запускает сервер с отчетом, который можно быстро открыть в браузере. Это удобный способ для локального использования, но отчетом нельзя поделиться напрямую.

Оба подхода полезны в зависимости от целей, рассмотрим их подробнее.

#### Генерация статического отчета

Для генерации статического отчета выполните команду:
```sh
allure generate ./allure-results --output=./allure-report
```
При успешном выполнении команда создаст папку allure-report с содержимым.

#### Генерация динамического отчета

Для динамической генерации отчета используется команда:
```sh
allure serve ./allure-results
```
Эта команда:
1. Генерирует временный отчет.
2. Запускает локальный сервер.
3. Автоматически открывает отчет в браузере.

[вверх](#81-знакомство-с-allure)


## Полезное:

Релизы Allure: https://github.com/allure-framework/allure2/releases

Установка allure в мой докер-образ (ну или в Debian 12):
```sh
sudo apt update
sudo apt install default-jre -y
wget https://github.com/allure-framework/allure2/releases/download/2.35.1/allure-2.35.1.tgz
mkdir ./allure
tar -xvzf allure-2.35.1.tgz -C ./allure
export PATH=$PATH:/home/vscode/allure/allure-2.35.1/bin
```

**Генерация отчета в папку, указанную в --output** (если ее нет, то allure ее сделает)
```sh
allure generate ./allure-results --output=./allure-report
```

**Опции в pytest.ini**
```ini
[pytest]
addopts = --alluredir allure-results
          --clean-alluredir
```
--clean-alluredir  
If set, the directory specified by --alluredir will be cleaned before generating new test results

[вверх](#81-знакомство-с-allure)
